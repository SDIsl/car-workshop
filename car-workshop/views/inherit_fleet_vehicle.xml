<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- NEW Form View Fleet Vehicle -->
        <record id='car-workshop_fleet_vehicle_view_form' model='ir.ui.view'>
            <field name="name">fleet.vehicle.form</field>
            <field name="model">fleet.vehicle</field>
            <field name="priority">40</field>
            <field name="arch" type="xml">
                <form string="Vehicle">
                <sheet>
                    <field name="image_client_vehicle" widget="image" class="oe_avatar"/>
                    <div class="oe_title">
                        <label for="model_id" class="oe_edit_only"/>
                        <h1>
                            <field name="model_id" placeholder="e.g. Model S"/>
                        </h1>
                        <label for="license_plate" class="oe_edit_only"/>
                        <h2>
                            <field name="license_plate" class="oe_inline" placeholder="e.g. PAE 326"/>
                        </h2>
                        <label for="tag_ids" class="oe_edit_only"/>
                        <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color', 'no_create_edit': True}"/>
                    </div>
                    <group col="2" string="General Properties">
                        <group>
                            <field name="driver_id"/>
                            <field name="location"/>
                            <field name="vin_sn"/>
                            <field name="model_year"/>
                            <field name="customer_id"/>
                            <field name="company_id" groups="base.group_multi_company"/>
                        </group>
                        <group>
                            <label for="odometer"/>
                            <div class="o_row">
                                <field name="odometer"/>
                                <field name="odometer_unit"/>
                            </div>
                            <field name="acquisition_date"/>
                            <field name="car_value"/>
                            <field name="residual_value"/>
                        </group>
                    </group>
                    <group col="2">
                        <group string="Additional Properties">
                            <field name="seats"/>
                            <field name="doors"/>
                            <field name="color"/>
                        </group>
                        <group string="Engine Options">
                            <field name="transmission"/>
                            <field name="fuel_type"/>
                            <label for="co2"/>
                            <div class="o_row" name="co2">
                                <field name="co2"/><span>g/km</span>
                            </div>
                            <field name="horsepower"/>
                            <field name="horsepower_tax"/>
                            <label for="power"/>
                            <div class="o_row">
                                <field name="power"/><span>kW</span>
                            </div>
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread" options="{&quot;thread_level&quot;: 1}"/>
                </div>
            </form>
            </field>
        </record>

        <record id='car-workshop_fleet_vehicle_view_kanban' model='ir.ui.view'>
        <field name="name">fleet.vehicle.kanban</field>
        <field name="model">fleet.vehicle</field>
        <field name="priority">1</field>
            <field name="arch" type="xml">
            <kanban>
                <field name="license_plate" />
                <field name="model_id" />
                <field name="driver_id" />
                <field name="location" />
                <field name="state_id" />
                <field name="id" />
                <field name="image_client_vehicle" />
                <field name="tag_ids" />
                <field name="contract_renewal_due_soon" />
                <field name="contract_renewal_overdue" />
                <field name="contract_renewal_name" />
                <field name="contract_renewal_total" />
                <field name="contract_count" />

                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_global_click">
                            <div class="o_kanban_image">
                                <img t-att-src="kanban_image('fleet.vehicle', 'image_client_vehicle', record.id.raw_value)"/>
                            </div>
                            <div class="oe_kanban_details">
                                <strong class="o_kanban_record_title">
                                    <field name="license_plate"/> : <field name="model_id"/>
                                </strong>
                                <div class="o_kanban_tags_section">
                                    <field name="tag_ids" widget="many2many_tags" options="{'color_field': 'color'}"/>
                                </div>
                                <ul>
                                    <li>
                                        <t t-if="record.driver_id.raw_value"><field name="driver_id"/></t>
                                    </li>
                                    <li>
                                        <t t-if="record.location.raw_value"><field name="location"/></t>
                                    </li>
                                </ul>
                            </div>
                            <div class="o_kanban_button">
                                <a t-if="record.contract_count.raw_value>0" data-type="object"
                                   data-name="return_action_to_open" href="#" class="oe_kanban_action oe_kanban_action_a"
                                   data-context='{"xml_id":"fleet_vehicle_log_contract_action","search_default_open": 1}'>
                                    <field name="contract_count"/>
                                    Contract(s)
                                    <span t-if="record.contract_renewal_due_soon.raw_value and !record.contract_renewal_overdue.raw_value"
                                        class="fa fa-exclamation-triangle" t-att-style="'color:orange'">
                                    </span>
                                     <span t-if="record.contract_renewal_overdue.raw_value"
                                        class="fa fa-exclamation-triangle" t-att-style="'color:red;'">
                                    </span>
                                </a>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

        <!--Action Vehicles Menu-->
        <record model="ir.actions.act_window" id="action_car_vehicles_config">
            <field name="name">Vehicles</field>
            <field name="res_model">fleet.vehicle</field>
            <field name="form_view_id" ref="car-workshop_fleet_vehicle_view_form"/>
            <field name="kanban_view_id" ref="car-workshop_fleet_vehicle_view_kanban"/>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,tree,form</field>
        </record>

        <!--Vehicles Menu-->
        <menuitem id="car_vehicles_menu" name="Vehicles"
                  parent="car_customers_menus"
                  sequence="2" action="action_car_vehicles_config"/>

        <!--Action Vehicle Models Menu-->
        <record model="ir.actions.act_window" id="action_car_vmodels_config">
            <field name="name">Vehicle Models</field>
            <field name="res_model">fleet.vehicle.model</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>

        <!--Action Vehicle Brand Menu-->
        <record model="ir.actions.act_window" id="action_car_vbrands_config">
            <field name="name">Vehicle Brands</field>
            <field name="res_model">fleet.vehicle.model.brand</field>
            <field name="view_type">form</field>
            <field name="view_mode">kanban,form</field>
        </record>

        <!--Vehicle Models Menu-->
        <menuitem id="car_vmodels_menu" name="Models"
                  parent="car_vconfig_menus"
                  sequence="1" action="action_car_vmodels_config"/>

        <!--Vehicle Brand Menu-->
        <menuitem id="car_vbrands_menu" name="Brands"
                  parent="car_vconfig_menus"
                  sequence="2" action="action_car_vbrands_config"/>
    </data>
</odoo>

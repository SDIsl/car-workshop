<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Project Project Form View -->
        <record id="car-workshop_project_view_form" model="ir.ui.view">
            <field name="name">Repair</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <form>
                    <sheet>
                        <group>
                            <group>

                                <field name="car_work"/>
                                <field name="name" class="o_project_name oe_inline" string="Project Name"
                                       placeholder="e.g. Office Party"/>

                                <label for="alias_name" string="Choose a Project Email"
                                       attrs="{'invisible': [('alias_domain', '=', False)]}"/>
                                <div name="alias_def" attrs="{'invisible': [('alias_domain', '=', False)]}">
                                    <field name="alias_name" class="oe_inline"/>@
                                    <field name="alias_domain" class="oe_inline" readonly="1"/>
                                </div>
                                <field name="user_id" invisible="1"/>
                            </group>
                        </group>
                        <footer>
                            <button string="Create &amp; Edit" name="edit_dialog" type="object" class="btn-primary"/>
                        </footer>
                    </sheet>
                </form>
            </field>
        </record>


        <record id="view_task_search_form" model="ir.ui.view">
            <field name="name">project.task.search.form</field>
            <field name="model">car_workshop.repair</field>
            <field name="arch" type="xml">
               <search string="Tasks">
                    <!--<field name="name" string="Repairs"/>-->
                    <!--<field name="tag_ids"/>-->
                    <!--<field name="partner_id"/>-->
                    <!--<field name="project_id"/>-->
                    <!--<field name="user_id"/>-->
                    <!--<field name="stage_id"/>-->
                    <!--<filter string="My Tasks" name="my_tasks" domain="[('user_id','=',uid)]"/>-->
                    <!--<filter string="My Followed Tasks" domain="[('message_is_follower', '=', True)]" />-->
                    <!--<filter string="Unassigned" name="unassigned" domain="[('user_id', '=', False)]"/>-->
                    <!--<separator/>-->
                    <!--<filter string="Starred" name="starred" domain="[('priority','in',[1, 2])]"/>-->
                    <!--<separator/>-->
                    <!--<filter string="Unread Messages" name="message_needaction" domain="[('message_needaction','=',True)]"/>-->
                    <!--<filter string="Archived" name="inactive" domain="[('active','=',False)]"/>-->
                    <!--<separator/>-->
                    <!--<filter string="My Activities" name="activities_my"-->
                        <!--domain="[('activity_ids.user_id', '=', uid)]"/>-->
                    <!--<separator/>-->
                    <!--<filter string="Late Activities" name="activities_overdue"-->
                        <!--domain="[('activity_ids.date_deadline', '&lt;', context_today().strftime('%Y-%m-%d'))]"-->
                        <!--help="Show all records which has next action date is before today"/>-->
                    <!--<filter string="Today Activities" name="activities_today"-->
                        <!--domain="[('activity_ids.date_deadline', '=', context_today().strftime('%Y-%m-%d'))]"/>-->
                    <!--<filter string="Future Activities" name="activities_upcoming_all"-->
                        <!--domain="[('activity_ids.date_deadline', '&gt;', context_today().strftime('%Y-%m-%d'))-->
                        <!--]"/>-->
                    <!--<group expand="0" string="Group By">-->
                        <!--<filter string="Project" name="project" context="{'group_by':'project_id'}"/>-->
                        <!--<filter string="Task" context="{'group_by':'name'}"/>-->
                        <!--<filter string="Assigned to" name="User" context="{'group_by':'user_id'}"/>-->
                        <!--<filter string="Stage" name="Stage" context="{'group_by':'stage_id'}"/>-->
                        <!--<filter string="Company" context="{'group_by':'company_id'}" groups="base.group_multi_company"/>-->
                        <!--<separator/>-->
                        <!--<filter string="Last Message" name="group_message_last_post" context="{'group_by':'message_last_post:week'}"/>-->
                    <!--</group>-->
                </search>
            </field>
        </record>

        <!--Project Action for Kanban View-->
         <record id="action_car_project_kanban_to_repair_kanban" model="ir.actions.act_window">
            <field name="name">Repairs</field>
            <field name="res_model">car_workshop.repair</field>
            <field name="view_mode">kanban,form,calendar</field>
            <field name="kanban_view_id" ref="car-workshop_repair_view_kanban"/>
            <field name="context">{
                'group_by': 'stage_id',
                'search_default_project_id': [active_id],
                'default_project_id': active_id,
            }</field>
             <field name="search_view_id" ref="view_task_search_form"/>
        </record>

        <!--Project Project Kanban View-->
        <record id="car-workshop_project_view_kanban" model="ir.ui.view">
            <field name="name">project.project.kanban</field>
            <field name="model">project.project</field>
            <field name="arch" type="xml">
                <kanban class="oe_background_grey o_kanban_dashboard o_project_kanban o_emphasize_colors"
                        on_create="project.open_create_project">

                    <field name="color"/>
                    <field name="task_count"/>
                    <field name="task_needaction_count"/>
                    <field name="label_tasks"/>

                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="#{kanban_color(record.color.raw_value)} project.oe_kanban_global_click o_has_icon">
                                <field name="name"/>
                                <div class="o_project_kanban_boxes">
                                    <a class="o_project_kanban_box"
                                       name="%(action_car_project_kanban_to_repair_kanban)d" type="action">
                                        <!--La linea interior hace que vayamos a la ACCION project.project_2_..-->
                                        <div>
                                            <span class="o_value">
                                                <t t-esc="record.task_count.value"/>
                                            </span>
                                            <span class="o_label">

                                                <t t-esc="record.label_tasks.value"/>
                                            </span>

                                        </div>
                                    </a>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!--Action Areas Menu-->
        <record id="action_car_areas_menu" model="ir.actions.act_window">
            <field name="name">Areas</field>
            <field name="res_model">project.project</field>
            <field name="view_type">form</field>
            <field name="domain">[("car_work","=",True)]</field>
            <field name="view_mode">kanban,form</field>
            <field name="view_id" ref="car-workshop_project_view_kanban"/>
            <field name="res_id" ref="car-workshop_project_view_form"/>
            <!--<field name="search_view_id" ref="project.view_project_project_filter"/>-->
            <field name="target">main</field>
        </record>

        <!--Project Menu-->
        <menuitem id="car_areas_menu" name="Areas"
                  parent="main_car_workshop_menu"
                  sequence="1" action="action_car_areas_menu"/>

    </data>
</odoo>
